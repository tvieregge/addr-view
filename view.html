<meta charset="UTF-8"> 
<!DOCTYPE html>
<html>
	<head>
		<style>
/* Set the size of the div element that contains the map */
#map {
	height: 500px;  /* The height is 500 pixels */
	width: 100%;  /* The width is the width of the web page */
}
		</style>
	</head>
	<body>
		<h3>My Google Maps Demo</h3>
		<!--The div element for the map -->
		<div id="map"></div>
		<script>
			// Initialize and add the map
			var map;
			function initMap() {
				// The location of Uluru
				var ottawa = {lat: 45.421, lng: -75.697};
				// The map, centered at Ottawa
				map = new google.maps.Map(
					document.getElementById('map'), {zoom: 9, center: ottawa});
			}
		</script>

		<script src="https://maps.googleapis.com/maps/api/js?key=KEY_GOES_HERE&callback=initMap">	</script>

		<input type="file" id="files" name="files[]" multiple />
		</div>
		<hr />
		<output id="list">
		</output>
		<hr />
		<table id="contents" style="width:100%; height:400px;" border> </table>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script
			type="text/javascript"
			src="https://combinatronics.com/evanplaice/jquery-csv/master/src/jquery.csv.js"
		></script>

		<script>
			$(document).ready(function() {
				if(isAPIAvailable()) {
					$('#files').bind('change', handleFileSelect);
				}
			});

			function isAPIAvailable() {
				// Check for the various File API support.
				if (window.File && window.FileReader && window.FileList && window.Blob) {
					// Great success! All the File APIs are supported.
					return true;
				} else {
					// source: File API availability - http://caniuse.com/#feat=fileapi
					// source: <output> availability - http://html5doctor.com/the-output-element/
					document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
					// 6.0 File API & 13.0 <output>
					document.writeln(' - Google Chrome: 13.0 or later<br />');
					// 3.6 File API & 6.0 <output>
					document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
					// 10.0 File API & 10.0 <output>
					document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
					// ? File API & 5.1 <output>
					document.writeln(' - Safari: Not supported<br />');
					// ? File API & 9.2 <output>
					document.writeln(' - Opera: Not supported');
					return false;
				}
			}

			function handleFileSelect(evt) {
				var files = evt.target.files; // FileList object
				var file = files[0];

				// read the file metadata
				var output = ''
				output += '<span style="font-weight:bold;">' + escape(file.name) + '</span><br />\n';
				output += ' - FileType: ' + (file.type || 'n/a') + '<br />\n';
				output += ' - FileSize: ' + file.size + ' bytes<br />\n';
				output += ' - LastModified: ' + (file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() : 'n/a') + '<br />\n';

				// read the file contents
				printTable(file);

				// post the results
				$('#list').append(output);
			}

			var callback =
				function gcode(results, status) {
					if (status !== 'OK') {
						alert('Geocode was not successful for the following reason: ' + status);
						return;
					}
					const addr_col = 0;
					const name_col = 1;
					var pos = results[addr_col].geometry.location;
					console.log(results);
					var marker = new google.maps.Marker({
						position: pos,
						lable: results[name_col],
						map: map});
				}

			function printTable(file) {
				var geocoder = new google.maps.Geocoder();
				var reader = new FileReader();
				reader.readAsText(file);
				reader.onload = function(event){
					var csv = event.target.result;
					var data = $.csv.toArrays(csv);
					var html = '';
					for(var row in data) {
						html += '<tr>\r\n';
						geocoder.geocode({'address' : data[row][0]}, callback);
						for(var item in data[row]) {
							html += '<td>' + data[row][item] + '</td>\r\n';
						}
						html += '</tr>\r\n';
					}
					$('#contents').html(html);
				};
				reader.onerror = function(){ alert('Unable to read ' + file.fileName); };
			}
		</script>
	</body>
</html>
